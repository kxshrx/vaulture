<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Integration Test - Vaulture</title>
    <link rel="stylesheet" href="css/main.css" />
  </head>
  <body>
    <!-- Header with proper navigation structure -->
    <header class="header">
      <div class="header-content">
        <a href="index.html" class="logo">Vaulture</a>

        <nav class="nav">
          <a href="marketplace.html" class="nav-link">Marketplace</a>
          <a href="dashboard.html" class="nav-link">Dashboard</a>
          <a href="profile.html" class="nav-link">Profile</a>
        </nav>

        <div class="nav-actions">
          <!-- Required navigation elements -->
          <div class="nav-actions-logged-out" id="navLoggedOut">
            <a href="login.html" class="btn btn-secondary">Log in</a>
            <a href="signup.html" class="btn btn-primary">Sign up</a>
          </div>

          <div class="nav-actions-logged-in" id="navLoggedIn">
            <div class="user-dropdown">
              <div
                class="user-avatar"
                onclick="toggleUserDropdown()"
                id="userAvatarBtn"
              >
                <div class="avatar-circle">
                  <span id="navAvatarInitials">U</span>
                </div>
              </div>
              <div
                class="dropdown-menu"
                id="userDropdownMenu"
                style="display: none"
              >
                <div
                  class="dropdown-item"
                  style="font-weight: 600; color: var(--text-primary)"
                >
                  <span id="userDisplayName">User</span>
                </div>
                <div class="dropdown-divider"></div>
                <a href="profile.html" class="dropdown-item"
                  >Profile Settings</a
                >
                <a href="dashboard.html" class="dropdown-item">Dashboard</a>
                <a href="marketplace.html" class="dropdown-item">Marketplace</a>
                <div class="dropdown-divider"></div>
                <button class="dropdown-item logout-btn" onclick="logout()">
                  Sign Out
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main style="padding-top: var(--header-height)">
      <section class="section">
        <div class="container">
          <h1>Integration Test Page</h1>
          <p>
            This page tests all the fixes implemented for the frontend issues.
          </p>

          <div class="grid grid-2" style="margin-top: var(--spacing-xl)">
            <!-- Test Notifications -->
            <div class="card">
              <div class="card-header">
                <h3>Notification System</h3>
              </div>
              <div class="card-body">
                <p>Test the improved notification system:</p>
                <div
                  style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap"
                >
                  <button
                    class="btn btn-primary"
                    onclick="testNotification('success')"
                  >
                    Success
                  </button>
                  <button
                    class="btn btn-secondary"
                    onclick="testNotification('error')"
                  >
                    Error
                  </button>
                  <button class="btn" onclick="testNotification('warning')">
                    Warning
                  </button>
                  <button class="btn" onclick="testNotification('info')">
                    Info
                  </button>
                </div>
              </div>
            </div>

            <!-- Test API Configuration -->
            <div class="card">
              <div class="card-header">
                <h3>API Configuration</h3>
              </div>
              <div class="card-body">
                <p>Current API Base URL:</p>
                <code
                  id="apiBaseUrl"
                  style="
                    background: var(--background-light);
                    padding: var(--spacing-xs);
                    border-radius: var(--radius-sm);
                  "
                  >Loading...</code
                >
                <br /><br />
                <button class="btn btn-primary" onclick="testApiConfig()">
                  Test API Config
                </button>
              </div>
            </div>

            <!-- Test File Upload -->
            <div class="card">
              <div class="card-header">
                <h3>File Upload System</h3>
              </div>
              <div class="card-body">
                <div
                  id="testFileUpload"
                  style="min-height: 120px; margin: var(--spacing-md) 0"
                >
                  <!-- File upload area will be initialized here -->
                </div>
                <button
                  class="btn btn-primary"
                  onclick="initializeFileUpload()"
                >
                  Initialize File Upload
                </button>
              </div>
            </div>

            <!-- Test Form Handler -->
            <div class="card">
              <div class="card-header">
                <h3>Form Handler</h3>
              </div>
              <div class="card-body">
                <form id="testForm" class="form">
                  <div class="form-group">
                    <label for="testEmail" class="form-label">Email</label>
                    <input
                      type="email"
                      id="testEmail"
                      name="testEmail"
                      class="form-input"
                      required
                    />
                  </div>
                  <div class="form-group">
                    <label for="testPassword" class="form-label"
                      >Password</label
                    >
                    <input
                      type="password"
                      id="testPassword"
                      name="testPassword"
                      class="form-input"
                      required
                    />
                  </div>
                  <button type="submit" class="btn btn-primary">
                    Test Form
                  </button>
                </form>
              </div>
            </div>

            <!-- Test Navigation State -->
            <div class="card">
              <div class="card-header">
                <h3>Navigation State</h3>
              </div>
              <div class="card-body">
                <p>
                  Current auth state: <span id="authState">Loading...</span>
                </p>
                <div
                  style="
                    display: flex;
                    gap: var(--spacing-sm);
                    flex-wrap: wrap;
                    margin-top: var(--spacing-md);
                  "
                >
                  <button class="btn btn-primary" onclick="simulateLogin()">
                    Simulate Login
                  </button>
                  <button class="btn btn-secondary" onclick="simulateLogout()">
                    Simulate Logout
                  </button>
                  <button class="btn" onclick="clearAllAuthData()">
                    Clear All Data
                  </button>
                </div>
              </div>
            </div>

            <!-- Test Modal -->
            <div class="card">
              <div class="card-header">
                <h3>Modal System</h3>
              </div>
              <div class="card-body">
                <button class="btn btn-primary" onclick="testModal()">
                  Open Test Modal
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Test Modal -->
    <div id="testModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Test Modal</h3>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <p>
            This is a test modal to verify the modal system is working
            correctly.
          </p>
          <p>All modal functionality should work including:</p>
          <ul>
            <li>Opening with smooth animation</li>
            <li>Closing with escape key</li>
            <li>Closing by clicking outside</li>
            <li>Closing with the X button</li>
          </ul>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary modal-close">Close</button>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="js/main.js"></script>
    <script>
      let testFileUpload;

      // Test functions
      function testNotification(type) {
        const messages = {
          success:
            "This is a success notification! Everything worked perfectly.",
          error: "This is an error notification! Something went wrong.",
          warning: "This is a warning notification! Please be careful.",
          info: "This is an info notification! Here's some useful information.",
        };

        Utils.showNotification(messages[type], type);
      }

      function testApiConfig() {
        const apiBaseUrl = api.getApiBaseUrl();
        document.getElementById("apiBaseUrl").textContent = apiBaseUrl;
        Utils.showNotification(`API Base URL: ${apiBaseUrl}`, "info");
      }

      function initializeFileUpload() {
        const uploadArea = document.getElementById("testFileUpload");
        testFileUpload = new FileUpload(uploadArea, {
          maxSize: 10 * 1024 * 1024, // 10MB
          allowedTypes: [".jpg", ".jpeg", ".png", ".gif", ".pdf", ".zip"],
          onFilesSelected: (files) => {
            Utils.showNotification(
              `File selected: ${files[0].name} (${Utils.formatFileSize(
                files[0].size
              )})`,
              "success"
            );
          },
        });

        testFileUpload.updateText(
          "Click to select a test file or drag and drop"
        );
      }

      function simulateLogin() {
        // Simulate login with fake data
        api.setToken("fake-token-for-testing");
        api.setUserType("creator");
        api.setUserProfile({
          display_name: "Test User",
          email: "test@example.com",
          account_type: "creator",
        });

        updateNavigationState();
        updateAuthState();
        Utils.showNotification("Simulated login successful!", "success");
      }

      function simulateLogout() {
        api.removeToken();
        updateNavigationState();
        updateAuthState();
        Utils.showNotification("Simulated logout successful!", "info");
      }

      function updateAuthState() {
        const token = localStorage.getItem("authToken");
        const userType = localStorage.getItem("userType");
        const authStateEl = document.getElementById("authState");

        if (token) {
          authStateEl.textContent = `Logged in as ${userType || "user"}`;
          authStateEl.style.color = "var(--success-color)";
        } else {
          authStateEl.textContent = "Not logged in";
          authStateEl.style.color = "var(--text-muted)";
        }
      }

      function testModal() {
        const modal = new Modal("testModal");
        modal.open();
      }

      // Initialize page
      document.addEventListener("DOMContentLoaded", () => {
        console.log("Integration test page loaded");

        // Test API config on load
        testApiConfig();
        updateAuthState();

        // Test form handler
        const testForm = document.getElementById("testForm");
        if (testForm) {
          testForm.addEventListener("submit", (e) => {
            e.preventDefault();
            Utils.showNotification(
              "Form handler is working correctly!",
              "success"
            );
          });
        }

        // Test periodic auth state updates
        setInterval(updateAuthState, 5000);
      });
    </script>
  </body>
</html>
