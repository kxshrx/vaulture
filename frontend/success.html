<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Purchase Successful - Vaulture</title>
    <meta
      name="description"
      content="Your purchase was successful! Download your content now."
    />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Styles -->
    <link rel="stylesheet" href="css/main.css" />

    <!-- Favicon -->
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ”’</text></svg>"
    />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <a href="index.html" class="logo">Vaulture</a>

        <nav class="nav">
          <a href="marketplace.html" class="nav-link">Marketplace</a>
          <a href="dashboard.html" class="nav-link">Dashboard</a>
          <a href="profile.html" class="nav-link">Profile</a>
        </nav>

        <div class="nav-actions">
          <!-- Success page should show avatar if logged in -->
          <div class="nav-actions-logged-out" id="navLoggedOut">
            <a href="login.html" class="btn btn-secondary">Log in</a>
            <a href="signup.html" class="btn btn-primary">Sign up</a>
          </div>

          <div class="nav-actions-logged-in" id="navLoggedIn">
            <div
              class="user-avatar"
              onclick="window.location.href='profile.html'"
            >
              <div class="avatar-circle">
                <span id="navAvatarInitials">U</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main style="padding-top: var(--header-height)">
      <!-- Success Section -->
      <section class="section">
        <div class="container">
          <div style="max-width: 600px; margin: 0 auto; text-align: center">
            <!-- Success Icon -->
            <div style="font-size: 4rem; margin-bottom: var(--spacing-lg)">
              âœ…
            </div>

            <h1>Purchase Successful!</h1>
            <p
              style="
                font-size: var(--font-size-lg);
                margin-bottom: var(--spacing-xl);
              "
            >
              Thank you for your purchase. Your content is ready for download.
            </p>

            <!-- Purchase Details -->
            <div
              class="card"
              style="margin-bottom: var(--spacing-xl)"
              id="purchaseDetails"
            >
              <div class="card-body">
                <div class="text-center" style="padding: var(--spacing-xl)">
                  <div
                    class="loading"
                    style="height: 60px; margin-bottom: var(--spacing-md)"
                  ></div>
                  <p>Loading purchase details...</p>
                </div>
              </div>
            </div>

            <!-- Download Section -->
            <div class="card" style="margin-bottom: var(--spacing-xl)">
              <div class="card-header">
                <h3>Download Your Content</h3>
              </div>
              <div class="card-body">
                <div
                  style="
                    display: flex;
                    align-items: center;
                    gap: var(--spacing-md);
                    margin-bottom: var(--spacing-lg);
                  "
                >
                  <div style="font-size: var(--font-size-xl)">ðŸ“¥</div>
                  <div style="flex: 1; text-align: left">
                    <h4>Instant Access</h4>
                    <p style="margin: 0; color: var(--text-secondary)">
                      Your digital content is ready for immediate download
                    </p>
                  </div>
                </div>

                <button
                  class="btn btn-primary btn-lg"
                  id="downloadBtn"
                  style="width: 100%"
                >
                  <svg
                    width="20"
                    height="20"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    style="margin-right: var(--spacing-xs)"
                  >
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7,10 12,15 17,10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                  </svg>
                  Download Now
                </button>

                <div
                  style="
                    margin-top: var(--spacing-md);
                    font-size: var(--font-size-sm);
                    color: var(--text-muted);
                  "
                >
                  ðŸ’¡ Tip: You can always access your purchases from your
                  dashboard
                </div>
              </div>
            </div>

            <!-- Receipt Information -->
            <div class="card" style="margin-bottom: var(--spacing-xl)">
              <div class="card-header">
                <h3>Receipt & Support</h3>
              </div>
              <div class="card-body">
                <div
                  style="
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: var(--spacing-lg);
                    text-align: left;
                  "
                >
                  <div>
                    <div
                      style="
                        display: flex;
                        align-items: center;
                        gap: var(--spacing-sm);
                        margin-bottom: var(--spacing-sm);
                      "
                    >
                      <span>ðŸ“§</span>
                      <strong>Email Receipt</strong>
                    </div>
                    <p
                      style="
                        margin: 0;
                        color: var(--text-secondary);
                        font-size: var(--font-size-sm);
                      "
                    >
                      A receipt has been sent to your email address with
                      download links and purchase details.
                    </p>
                  </div>

                  <div>
                    <div
                      style="
                        display: flex;
                        align-items: center;
                        gap: var(--spacing-sm);
                        margin-bottom: var(--spacing-sm);
                      "
                    >
                      <span>ðŸ”’</span>
                      <strong>Lifetime Access</strong>
                    </div>
                    <p
                      style="
                        margin: 0;
                        color: var(--text-secondary);
                        font-size: var(--font-size-sm);
                      "
                    >
                      You have permanent access to this content. Re-download
                      anytime from your dashboard.
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Next Steps -->
            <div
              style="
                display: flex;
                flex-wrap: wrap;
                gap: var(--spacing-md);
                justify-content: center;
              "
            >
              <a href="dashboard.html" class="btn btn-secondary">
                View All Purchases
              </a>
              <a href="marketplace.html" class="btn btn-secondary">
                Browse More Content
              </a>
            </div>

            <!-- Social Sharing -->
            <div
              style="
                margin-top: var(--spacing-2xl);
                padding: var(--spacing-lg);
                border: 1px solid var(--border-color);
                border-radius: var(--radius-lg);
                background-color: var(--background-light);
              "
            >
              <h4>Love what you bought?</h4>
              <p
                style="
                  color: var(--text-secondary);
                  margin-bottom: var(--spacing-md);
                "
              >
                Share Vaulture with your friends and help support digital
                creators
              </p>
              <div
                style="
                  display: flex;
                  gap: var(--spacing-sm);
                  justify-content: center;
                "
              >
                <button
                  class="btn btn-secondary btn-sm"
                  onclick="shareOnTwitter()"
                >
                  Share on Twitter
                </button>
                <button class="btn btn-secondary btn-sm" onclick="copyLink()">
                  Copy Link
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Notifications Container -->
    <div
      class="notifications-container"
      style="
        position: fixed;
        top: var(--spacing-md);
        right: var(--spacing-md);
        z-index: 1000;
      "
    ></div>

    <!-- Scripts -->
    <script src="js/main.js"></script>
    <script>
      class PurchaseSuccess {
        constructor() {
          this.productId = null;
          this.purchaseId = null;

          this.initializeElements();
          this.loadPurchaseDetails();
        }

        initializeElements() {
          // Get parameters from URL
          const urlParams = new URLSearchParams(window.location.search);
          this.productId = urlParams.get("product");
          this.purchaseId = urlParams.get("purchase");

          this.downloadBtn = document.getElementById("downloadBtn");
          this.downloadBtn.addEventListener("click", () =>
            this.downloadProduct()
          );

          // If no product ID, redirect to marketplace
          if (!this.productId) {
            Utils.showNotification("No purchase information found", "warning");
            setTimeout(() => {
              window.location.href = "marketplace.html";
            }, 2000);
            return;
          }
        }

        async loadPurchaseDetails() {
          try {
            // Check authentication
            if (!checkAuth()) {
              Utils.showNotification(
                "Please log in to view your purchase",
                "warning"
              );
              window.location.href = "login.html";
              return;
            }

            // In a real implementation, you would fetch the actual purchase details
            // For now, we'll simulate the data
            const purchaseDetails = {
              id: this.purchaseId || "DEMO123",
              product: {
                id: this.productId,
                title: "Sample Digital Product",
                description:
                  "This is a sample product for demonstration purposes.",
                price: 29.99,
                creator_name: "Sample Creator",
                category: "design",
                file_type: "application/zip",
              },
              amount_paid: 31.49, // Including 5% platform fee
              payment_status: "completed",
              created_at: new Date().toISOString(),
            };

            this.displayPurchaseDetails(purchaseDetails);
          } catch (error) {
            console.error("Failed to load purchase details:", error);
            Utils.showNotification(
              "Failed to load purchase information",
              "error"
            );
          }
        }

        displayPurchaseDetails(purchase) {
          const detailsContainer = document.getElementById("purchaseDetails");

          detailsContainer.innerHTML = `
                    <div class="card-header">
                        <h3>Purchase Details</h3>
                    </div>
                    <div class="card-body">
                        <div style="display: flex; gap: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                            <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; color: white; font-size: var(--font-size-lg);">
                                ${this.getFileTypeIcon(
                                  purchase.product.file_type
                                )}
                            </div>
                            <div style="flex: 1;">
                                <h4>${Utils.sanitizeHTML(
                                  purchase.product.title
                                )}</h4>
                                <p style="color: var(--text-secondary); margin: var(--spacing-xs) 0;">
                                    by ${Utils.sanitizeHTML(
                                      purchase.product.creator_name
                                    )}
                                </p>
                                <div style="font-size: var(--font-size-sm); color: var(--text-muted);">
                                    ${
                                      purchase.product.category
                                    } â€¢ Purchased ${Utils.formatDate(
            purchase.created_at
          )}
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: var(--font-size-lg); font-weight: 600;">
                                    ${Utils.formatPrice(purchase.amount_paid)}
                                </div>
                                <div style="font-size: var(--font-size-sm); color: var(--success-color);">
                                    âœ“ Paid
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-lg); padding: var(--spacing-md); background-color: var(--background-light); border-radius: var(--radius-md);">
                            <div>
                                <div style="font-size: var(--font-size-sm); color: var(--text-muted);">Order ID</div>
                                <div style="font-weight: 500;">#${
                                  purchase.id
                                }</div>
                            </div>
                            <div>
                                <div style="font-size: var(--font-size-sm); color: var(--text-muted);">Payment Status</div>
                                <div style="font-weight: 500; color: var(--success-color);">
                                    âœ“ ${
                                      purchase.payment_status
                                        .charAt(0)
                                        .toUpperCase() +
                                      purchase.payment_status.slice(1)
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                `;
        }

        getFileTypeIcon(fileType) {
          if (!fileType) return "ðŸ“„";

          if (fileType.includes("image")) return "ðŸ–¼ï¸";
          if (fileType.includes("video")) return "ðŸŽ¥";
          if (fileType.includes("audio")) return "ðŸŽµ";
          if (fileType.includes("pdf")) return "ðŸ“‹";
          if (fileType.includes("zip") || fileType.includes("archive"))
            return "ðŸ“¦";
          if (fileType.includes("text") || fileType.includes("code"))
            return "ðŸ’»";

          return "ðŸ“„";
        }

        downloadProduct() {
          try {
            Utils.showNotification("Starting download...", "info");

            // In a real implementation, this would:
            // 1. Verify the user owns this product
            // 2. Generate a secure download URL
            // 3. Initiate the download

            // For demo purposes, we'll just show a message
            setTimeout(() => {
              Utils.showNotification(
                "Download started! Check your downloads folder.",
                "success"
              );
            }, 1000);

            // Simulate file download
            // window.open(`/download/${this.productId}`, '_blank');
          } catch (error) {
            Utils.showNotification(
              "Download failed. Please try again or contact support.",
              "error"
            );
          }
        }
      }

      // Utility functions for social sharing
      function shareOnTwitter() {
        const text =
          "I just purchased amazing digital content on Vaulture! ðŸš€ Check out this platform for creators and buyers.";
        const url = "https://vaulture.com";
        const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(
          text
        )}&url=${encodeURIComponent(url)}`;
        window.open(twitterUrl, "_blank");
      }

      function copyLink() {
        const url = "https://vaulture.com";
        navigator.clipboard
          .writeText(url)
          .then(() => {
            Utils.showNotification("Link copied to clipboard!", "success");
          })
          .catch(() => {
            Utils.showNotification("Failed to copy link", "error");
          });
      }

      // Initialize success page
      let purchaseSuccess;
      document.addEventListener("DOMContentLoaded", () => {
        purchaseSuccess = new PurchaseSuccess();
      });
    </script>
  </body>
</html>
